<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='ÈöèÁùÄÈ°πÁõÆÁöÑ‰∏çÊñ≠Â¢ûÂ§öÔºåÊúÄÂºÄÂßãÂçï‰ΩìÈ°πÁõÆÊâãÂä®ÊâßË°å docker build ÂëΩ‰ª§ÔºåÊâãÂä®ÂèëÂ∏ÉÈ°πÁõÆÂ∞±‰∏çÂÜçÈÄÇÁî®‰∫Ü„ÄÇ‰∏Ä‰∏§‰∏™È°πÁõÆÂèØËÉΩËøòÂêÉÂæóÊ∂àÔºå10 Â§ö‰∏™È°πÁõÆÊØèÂ§©ËÆ©‰Ω†ÊûÑÂª∫‰∏ÄÊ¨°ËøòÊòØÂ§üÂëõ„ÄÇÂç≥‰æø‰Ω†ÁöÑÈ°πÁõÆÂ∞ëÔºåÊØèÊ¨°Ëä±Ë¥πÂú®ÂèëÂ∏É‰∏äÈù¢ÁöÑÊó∂Èó¥Á¥ØËÆ°Ëµ∑Êù•ÈÉΩÂ§ü‰Ω†ÊîπÂá†‰∏™ BUG ‰∫Ü„ÄÇ
ÊâÄ‰ª•Êàë‰ª¨ÈúÄË¶ÅËá™Âä®ÂåñËøô‰∏™ÊµÅÁ®ãÔºåËÆ©È°πÁõÆÁöÑÂèëÂ∏ÉÂíåÊµãËØï‰∏çÂÜçËøô‰πàÁπÅÁêê„ÄÇÂú®ËøôÈáåÊàë‰ΩøÁî®‰∫Ü Jenkins ‰Ωú‰∏∫Âü∫Á°ÄÁöÑ CI/CD Pipeline Â∑•ÂÖ∑ÔºåÂÖ≥‰∫é Jenkins ÁöÑÂÖ∑‰Ωì‰ªãÁªçËøôÈáåÂ∞±‰∏çÂÜçËµòËø∞„ÄÇÂú®ÁâàÊú¨ÁÆ°ÁêÜ„ÄÅÊûÑÂª∫È°πÁõÆ„ÄÅÂçïÂÖÉÊµãËØï„ÄÅÈõÜÊàêÊµãËØï„ÄÅÁéØÂ¢ÉÈÉ®ÁΩ≤ÊàëÂàÜÂà´‰ΩøÁî®Âà∞‰∫Ü Gogs„ÄÅDocker„ÄÅDocker Swarm(Â∑≤‰∏é Docker Êï¥Âêà) ËøôÂá†‰∏™ËΩØ‰ª∂ÂçèÂêåÂ∑•‰Ωú„ÄÇ
‰ª•‰∏ãÊ≠•È™§ÊàëÂèÇËÄÉ‰∫Ü Continuous Integration with Jenkins and Docker ‰∏ÄÊñáÔºåÂπ∂‰ΩøÁî®‰∫Ü‰ΩúËÄÖÊèê‰æõÁöÑ groovy Êñá‰ª∂Âíå slave.py Êñá‰ª∂„ÄÇ
ÂÖ≥‰∫é Docker-CE ÁöÑÂÆâË£ÖÔºåËØ∑ÂèÇËÄÉÊàëÁöÑÂè¶‰∏ÄÁØáÂçöÊñá „ÄäLinux ‰∏ãÁöÑ Docker ÂÆâË£Ö‰∏é‰ΩøÁî®„Äã „ÄÇ
'><title>Jenkins ÁªìÂêà Docker ÂÆûÁé∞‰ΩéÈÖçÁâàÁöÑ CI&amp;CD</title>

<link rel='canonical' href='https://real-zony.github.io/p/jenkins-combines-docker-to-implement-low-level-ci/'>

<link rel="stylesheet" href="/scss/style.min.ac77dcf8b111b51da39a92990f431923f210f3876d85798a2125667f96dc33a4.css"><meta property='og:title' content='Jenkins ÁªìÂêà Docker ÂÆûÁé∞‰ΩéÈÖçÁâàÁöÑ CI&amp;CD'>
<meta property='og:description' content='ÈöèÁùÄÈ°πÁõÆÁöÑ‰∏çÊñ≠Â¢ûÂ§öÔºåÊúÄÂºÄÂßãÂçï‰ΩìÈ°πÁõÆÊâãÂä®ÊâßË°å docker build ÂëΩ‰ª§ÔºåÊâãÂä®ÂèëÂ∏ÉÈ°πÁõÆÂ∞±‰∏çÂÜçÈÄÇÁî®‰∫Ü„ÄÇ‰∏Ä‰∏§‰∏™È°πÁõÆÂèØËÉΩËøòÂêÉÂæóÊ∂àÔºå10 Â§ö‰∏™È°πÁõÆÊØèÂ§©ËÆ©‰Ω†ÊûÑÂª∫‰∏ÄÊ¨°ËøòÊòØÂ§üÂëõ„ÄÇÂç≥‰æø‰Ω†ÁöÑÈ°πÁõÆÂ∞ëÔºåÊØèÊ¨°Ëä±Ë¥πÂú®ÂèëÂ∏É‰∏äÈù¢ÁöÑÊó∂Èó¥Á¥ØËÆ°Ëµ∑Êù•ÈÉΩÂ§ü‰Ω†ÊîπÂá†‰∏™ BUG ‰∫Ü„ÄÇ
ÊâÄ‰ª•Êàë‰ª¨ÈúÄË¶ÅËá™Âä®ÂåñËøô‰∏™ÊµÅÁ®ãÔºåËÆ©È°πÁõÆÁöÑÂèëÂ∏ÉÂíåÊµãËØï‰∏çÂÜçËøô‰πàÁπÅÁêê„ÄÇÂú®ËøôÈáåÊàë‰ΩøÁî®‰∫Ü Jenkins ‰Ωú‰∏∫Âü∫Á°ÄÁöÑ CI/CD Pipeline Â∑•ÂÖ∑ÔºåÂÖ≥‰∫é Jenkins ÁöÑÂÖ∑‰Ωì‰ªãÁªçËøôÈáåÂ∞±‰∏çÂÜçËµòËø∞„ÄÇÂú®ÁâàÊú¨ÁÆ°ÁêÜ„ÄÅÊûÑÂª∫È°πÁõÆ„ÄÅÂçïÂÖÉÊµãËØï„ÄÅÈõÜÊàêÊµãËØï„ÄÅÁéØÂ¢ÉÈÉ®ÁΩ≤ÊàëÂàÜÂà´‰ΩøÁî®Âà∞‰∫Ü Gogs„ÄÅDocker„ÄÅDocker Swarm(Â∑≤‰∏é Docker Êï¥Âêà) ËøôÂá†‰∏™ËΩØ‰ª∂ÂçèÂêåÂ∑•‰Ωú„ÄÇ
‰ª•‰∏ãÊ≠•È™§ÊàëÂèÇËÄÉ‰∫Ü Continuous Integration with Jenkins and Docker ‰∏ÄÊñáÔºåÂπ∂‰ΩøÁî®‰∫Ü‰ΩúËÄÖÊèê‰æõÁöÑ groovy Êñá‰ª∂Âíå slave.py Êñá‰ª∂„ÄÇ
ÂÖ≥‰∫é Docker-CE ÁöÑÂÆâË£ÖÔºåËØ∑ÂèÇËÄÉÊàëÁöÑÂè¶‰∏ÄÁØáÂçöÊñá „ÄäLinux ‰∏ãÁöÑ Docker ÂÆâË£Ö‰∏é‰ΩøÁî®„Äã „ÄÇ
'>
<meta property='og:url' content='https://real-zony.github.io/p/jenkins-combines-docker-to-implement-low-level-ci/'>
<meta property='og:site_name' content='Zony ÁöÑÂçöÂÆ¢'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='Jenkins' /><meta property='article:tag' content='Docker' /><meta property='article:tag' content='CI/CD' /><meta property='article:tag' content='Docker Compose' /><meta property='article:tag' content='DevOps' /><meta property='article:tag' content='Linux' /><meta property='article:published_time' content='2019-09-25T04:42:11&#43;00:00'/><meta property='article:modified_time' content='2019-09-25T04:42:11&#43;00:00'/>
<meta name="twitter:title" content="Jenkins ÁªìÂêà Docker ÂÆûÁé∞‰ΩéÈÖçÁâàÁöÑ CI&amp;CD">
<meta name="twitter:description" content="ÈöèÁùÄÈ°πÁõÆÁöÑ‰∏çÊñ≠Â¢ûÂ§öÔºåÊúÄÂºÄÂßãÂçï‰ΩìÈ°πÁõÆÊâãÂä®ÊâßË°å docker build ÂëΩ‰ª§ÔºåÊâãÂä®ÂèëÂ∏ÉÈ°πÁõÆÂ∞±‰∏çÂÜçÈÄÇÁî®‰∫Ü„ÄÇ‰∏Ä‰∏§‰∏™È°πÁõÆÂèØËÉΩËøòÂêÉÂæóÊ∂àÔºå10 Â§ö‰∏™È°πÁõÆÊØèÂ§©ËÆ©‰Ω†ÊûÑÂª∫‰∏ÄÊ¨°ËøòÊòØÂ§üÂëõ„ÄÇÂç≥‰æø‰Ω†ÁöÑÈ°πÁõÆÂ∞ëÔºåÊØèÊ¨°Ëä±Ë¥πÂú®ÂèëÂ∏É‰∏äÈù¢ÁöÑÊó∂Èó¥Á¥ØËÆ°Ëµ∑Êù•ÈÉΩÂ§ü‰Ω†ÊîπÂá†‰∏™ BUG ‰∫Ü„ÄÇ
ÊâÄ‰ª•Êàë‰ª¨ÈúÄË¶ÅËá™Âä®ÂåñËøô‰∏™ÊµÅÁ®ãÔºåËÆ©È°πÁõÆÁöÑÂèëÂ∏ÉÂíåÊµãËØï‰∏çÂÜçËøô‰πàÁπÅÁêê„ÄÇÂú®ËøôÈáåÊàë‰ΩøÁî®‰∫Ü Jenkins ‰Ωú‰∏∫Âü∫Á°ÄÁöÑ CI/CD Pipeline Â∑•ÂÖ∑ÔºåÂÖ≥‰∫é Jenkins ÁöÑÂÖ∑‰Ωì‰ªãÁªçËøôÈáåÂ∞±‰∏çÂÜçËµòËø∞„ÄÇÂú®ÁâàÊú¨ÁÆ°ÁêÜ„ÄÅÊûÑÂª∫È°πÁõÆ„ÄÅÂçïÂÖÉÊµãËØï„ÄÅÈõÜÊàêÊµãËØï„ÄÅÁéØÂ¢ÉÈÉ®ÁΩ≤ÊàëÂàÜÂà´‰ΩøÁî®Âà∞‰∫Ü Gogs„ÄÅDocker„ÄÅDocker Swarm(Â∑≤‰∏é Docker Êï¥Âêà) ËøôÂá†‰∏™ËΩØ‰ª∂ÂçèÂêåÂ∑•‰Ωú„ÄÇ
‰ª•‰∏ãÊ≠•È™§ÊàëÂèÇËÄÉ‰∫Ü Continuous Integration with Jenkins and Docker ‰∏ÄÊñáÔºåÂπ∂‰ΩøÁî®‰∫Ü‰ΩúËÄÖÊèê‰æõÁöÑ groovy Êñá‰ª∂Âíå slave.py Êñá‰ª∂„ÄÇ
ÂÖ≥‰∫é Docker-CE ÁöÑÂÆâË£ÖÔºåËØ∑ÂèÇËÄÉÊàëÁöÑÂè¶‰∏ÄÁØáÂçöÊñá „ÄäLinux ‰∏ãÁöÑ Docker ÂÆâË£Ö‰∏é‰ΩøÁî®„Äã „ÄÇ
">
  


    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="ÂàáÊç¢ËèúÂçï">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu88ff3bfa88d8ce73b9d64b435a0a3f2c_26917_300x0_resize_box_3.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">üç•</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">Zony ÁöÑÂçöÂÆ¢</a></h1>
            <h2 class="site-description">A .NET Developer</h2>
        </div>
    </header><ol class="social-menu">
            
                <li>
                    <a 
                        href='https://github.com/real-zony'
                        target="_blank"
                        title="GitHub"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        

        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>‰∏ªÈ°µ</span>
            </a>
        </li>
        
        

        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>ÂÖ≥‰∫é</span>
            </a>
        </li>
        
        

        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Â≠òÊ°£</span>
            </a>
        </li>
        
        

        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>ÊêúÁ¥¢</span>
            </a>
        </li>
        
        

        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        

        <div class="menu-bottom-section">
                <li id="i18n-switch">  
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                    <select name="language" onchange="window.location.href = this.selectedOptions[0].value">
                        
                            <option value="https://real-zony.github.io/en/" >English</option>
                        
                            <option value="https://real-zony.github.io/" selected>‰∏≠Êñá</option>
                        
                    </select>
                </li>
            
            
            
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <span>ÊöóËâ≤Ê®°Âºè</span>
                </li>
            
        </div>
    </ol>
</aside>
<main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/jenkins-combines-docker-to-implement-low-level-ci/">Jenkins ÁªìÂêà Docker ÂÆûÁé∞‰ΩéÈÖçÁâàÁöÑ CI&amp;CD</a>
        </h2>
    
        
    </div>

    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Sep 25, 2019</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    ÈòÖËØªÊó∂Èïø: 7 ÂàÜÈíü
                </time>
            </div>
        
    </footer>
    

    
</div>
</header>

    <section class="article-content">
    
    
    <p>ÈöèÁùÄÈ°πÁõÆÁöÑ‰∏çÊñ≠Â¢ûÂ§öÔºåÊúÄÂºÄÂßãÂçï‰ΩìÈ°πÁõÆÊâãÂä®ÊâßË°å <code>docker build</code> ÂëΩ‰ª§ÔºåÊâãÂä®ÂèëÂ∏ÉÈ°πÁõÆÂ∞±‰∏çÂÜçÈÄÇÁî®‰∫Ü„ÄÇ‰∏Ä‰∏§‰∏™È°πÁõÆÂèØËÉΩËøòÂêÉÂæóÊ∂àÔºå10 Â§ö‰∏™È°πÁõÆÊØèÂ§©ËÆ©‰Ω†ÊûÑÂª∫‰∏ÄÊ¨°ËøòÊòØÂ§üÂëõ„ÄÇÂç≥‰æø‰Ω†ÁöÑÈ°πÁõÆÂ∞ëÔºåÊØèÊ¨°Ëä±Ë¥πÂú®ÂèëÂ∏É‰∏äÈù¢ÁöÑÊó∂Èó¥Á¥ØËÆ°Ëµ∑Êù•ÈÉΩÂ§ü‰Ω†ÊîπÂá†‰∏™ BUG ‰∫Ü„ÄÇ</p>
<p>ÊâÄ‰ª•Êàë‰ª¨ÈúÄË¶ÅËá™Âä®ÂåñËøô‰∏™ÊµÅÁ®ãÔºåËÆ©È°πÁõÆÁöÑÂèëÂ∏ÉÂíåÊµãËØï‰∏çÂÜçËøô‰πàÁπÅÁêê„ÄÇÂú®ËøôÈáåÊàë‰ΩøÁî®‰∫Ü Jenkins ‰Ωú‰∏∫Âü∫Á°ÄÁöÑ CI/CD Pipeline Â∑•ÂÖ∑ÔºåÂÖ≥‰∫é Jenkins ÁöÑÂÖ∑‰Ωì‰ªãÁªçËøôÈáåÂ∞±‰∏çÂÜçËµòËø∞„ÄÇÂú®ÁâàÊú¨ÁÆ°ÁêÜ„ÄÅÊûÑÂª∫È°πÁõÆ„ÄÅÂçïÂÖÉÊµãËØï„ÄÅÈõÜÊàêÊµãËØï„ÄÅÁéØÂ¢ÉÈÉ®ÁΩ≤ÊàëÂàÜÂà´‰ΩøÁî®Âà∞‰∫Ü <strong>Gogs</strong>„ÄÅ<strong>Docker</strong>„ÄÅ<strong>Docker Swarm(Â∑≤‰∏é Docker Êï¥Âêà)</strong> ËøôÂá†‰∏™ËΩØ‰ª∂ÂçèÂêåÂ∑•‰Ωú„ÄÇ</p>
<p>‰ª•‰∏ãÊ≠•È™§ÊàëÂèÇËÄÉ‰∫Ü <strong><a class="link" href="https://code-maze.com/ci-jenkins-docker/#comments"  target="_blank" rel="noopener"
    >Continuous Integration with Jenkins and Docker</a></strong> ‰∏ÄÊñáÔºåÂπ∂‰ΩøÁî®‰∫Ü‰ΩúËÄÖÊèê‰æõÁöÑ groovy Êñá‰ª∂Âíå <code>slave.py</code> Êñá‰ª∂„ÄÇ</p>
<p>ÂÖ≥‰∫é <strong>Docker-CE</strong> ÁöÑÂÆâË£ÖÔºåËØ∑ÂèÇËÄÉÊàëÁöÑÂè¶‰∏ÄÁØáÂçöÊñá <a class="link" href="https://www.cnblogs.com/myzony/p/9071210.html"  target="_blank" rel="noopener"
    >„ÄäLinux ‰∏ãÁöÑ Docker ÂÆâË£Ö‰∏é‰ΩøÁî®„Äã</a> „ÄÇ</p>
<h2 id="‰∏Äjenkins-ÁöÑÈÉ®ÁΩ≤">‰∏Ä„ÄÅJenkins ÁöÑÈÉ®ÁΩ≤</h2>
<p>Êó¢ÁÑ∂ÈÉΩÁî®‰∫Ü DockerÔºåÊàëÊòØ‰∏çÊÉ≥Âú®ÂÆû‰ΩìÊú∫‰∏äÈù¢ÂÆâË£Ö‰∏ÄÂ†ÜÁéØÂ¢ÉÔºåÊâÄ‰ª•Êàë‰ΩøÁî®‰∫Ü Docker ÁöÑÂΩ¢ÂºèÊù•ÈÉ®ÁΩ≤ Jenkins ÁöÑ Master Âíå SlaveÔºåÁúÅÊó∂ÁúÅÂäõ„ÄÇMaster Â∞±ÊòØË∞ÉÂ∫¶ÁÆ°ÈÅì‰ªªÂä°ÁöÑ‰∏ªÊú∫Ôºå‰πüÊòØÂîØ‰∏ÄÊúâ UI ‰æõÁî®Êà∑Êìç‰ΩúÁöÑ„ÄÇËÄå Slave Â∞±ÊòØÂÖ∑‰ΩìÁöÑÂ∑•‰ΩúËäÇÁÇπÔºåÁî®‰∫éÊâßË°åÂÖ∑‰ΩìÁöÑÁÆ°ÈÅì‰ªªÂä°„ÄÇ</p>
<h3 id="11-ÊûÑÂª∫-master-ÈïúÂÉè">1.1 ÊûÑÂª∫ Master ÈïúÂÉè</h3>
<p>Á¨¨‰∏ÄÊ≠•ÔºåÊàë‰ª¨Âú®‰∏ªÊú∫‰∏äÂª∫Á´ã‰∏Ä‰∏™ master Êñá‰ª∂Â§πÔºåÂπ∂‰ΩøÁî® <code>vi </code>ÂàõÂª∫‰∏§‰∏™ groovy Êñá‰ª∂ÔºåËøô‰∏§‰∏™Êñá‰ª∂Âú®ÂêéÈù¢ÁöÑ Dockerfile ‰ºöË¢´‰ΩøÁî®Âà∞Ôºå‰∏ãÈù¢ÊòØ <code>default-user.groovy</code> Êñá‰ª∂ÁöÑ‰ª£Á†ÅÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-groovy" data-lang="groovy"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">jenkins.model.*</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">hudson.security.*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">def</span> <span class="n">env</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">getenv</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">def</span> <span class="n">jenkins</span> <span class="o">=</span> <span class="n">Jenkins</span><span class="o">.</span><span class="na">getInstance</span><span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="n">jenkins</span><span class="o">.</span><span class="na">setSecurityRealm</span><span class="o">(</span><span class="k">new</span> <span class="n">HudsonPrivateSecurityRealm</span><span class="o">(</span><span class="kc">false</span><span class="o">))</span>
</span></span><span class="line"><span class="cl"><span class="n">jenkins</span><span class="o">.</span><span class="na">setAuthorizationStrategy</span><span class="o">(</span><span class="k">new</span> <span class="n">GlobalMatrixAuthorizationStrategy</span><span class="o">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">def</span> <span class="n">user</span> <span class="o">=</span> <span class="n">jenkins</span><span class="o">.</span><span class="na">getSecurityRealm</span><span class="o">().</span><span class="na">createAccount</span><span class="o">(</span><span class="n">env</span><span class="o">.</span><span class="na">JENKINS_USER</span><span class="o">,</span> <span class="n">env</span><span class="o">.</span><span class="na">JENKINS_PASS</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="n">user</span><span class="o">.</span><span class="na">save</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">jenkins</span><span class="o">.</span><span class="na">getAuthorizationStrategy</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">Jenkins</span><span class="o">.</span><span class="na">ADMINISTER</span><span class="o">,</span> <span class="n">env</span><span class="o">.</span><span class="na">JENKINS_USER</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="n">jenkins</span><span class="o">.</span><span class="na">save</span><span class="o">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Êé•ÁùÄÂÜçÁî® <code>vi</code> ÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑ <code>executors.groovy</code> Êñá‰ª∂ÔºåÂπ∂ËæìÂÖ•‰ª•‰∏ãÂÜÖÂÆπÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-groovy" data-lang="groovy"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">jenkins.model.*</span>
</span></span><span class="line"><span class="cl"><span class="n">Jenkins</span><span class="o">.</span><span class="na">instance</span><span class="o">.</span><span class="na">setNumExecutors</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰ª•‰∏äÂä®‰ΩúÂÆåÊàê‰πãÂêéÔºåÂú® master Êñá‰ª∂Â§π‰∏ãÈù¢Â∫îËØ•Êúâ‰∏§‰∏™ groovy Êñá‰ª∂„ÄÇ</p>
<p><img src="/p/jenkins-combines-docker-to-implement-low-level-ci/1569304766695.png"
	width="1187"
	height="122"
	srcset="/p/jenkins-combines-docker-to-implement-low-level-ci/1569304766695_hu610ff5b4b3e945607ef9c8b934cff5f1_30298_480x0_resize_box_3.png 480w, /p/jenkins-combines-docker-to-implement-low-level-ci/1569304766695_hu610ff5b4b3e945607ef9c8b934cff5f1_30298_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="1569304766695"
	
	
		class="gallery-image" 
		data-flex-grow="972"
		data-flex-basis="2335px"
	
></p>
<p>‰∏§‰∏™ master ÊâÄÈúÄË¶ÅÁöÑ groovy Êñá‰ª∂Â∑≤ÁªèÁºñÂÜôÂÆåÊàêÔºå‰∏ãÈù¢Êù•ÁºñÂÜô master ÈïúÂÉèÁöÑ Dockerfile Êñá‰ª∂ÔºåÊØè‰∏ÄÊ≠•ÁöÑ‰ΩúÁî®ÊàëÂ∑≤ÁªèÁî®‰∏≠ÊñáËøõË°å‰∫ÜÊ†áÊ≥®„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># ‰ΩøÁî®ÂÆòÊñπÁöÑ Jenkins ÈïúÂÉè‰Ωú‰∏∫Âü∫Á°ÄÈïúÂÉè„ÄÇ</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> jenkins/jenkins:latest</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span> <span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># ‰ΩøÁî®ÂÜÖÁΩÆÁöÑ install-plugins.sh Êù•ÂÆâË£ÖÊèí‰ª∂„ÄÇ</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> /usr/local/bin/install-plugins.sh git matrix-auth workflow-aggregator docker-workflow blueocean credentials-binding<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span> <span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># ËÆæÁΩÆ Jenkins ÁöÑÁÆ°ÁêÜÂëòË¥¶Êà∑ÂíåÂØÜÁ†Å„ÄÇ</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENV</span> JENKINS_USER admin<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENV</span> JENKINS_PASS admin<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span> <span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Ë∑≥ËøáÂàùÂßãÂåñÂÆâË£ÖÂêëÂØº„ÄÇ</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENV</span> JAVA_OPTS -Djenkins.install.runSetupWizard<span class="o">=</span>false<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span> <span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Â∞ÜÂàöÂàöÁºñÂÜôÁöÑ‰∏§‰∏™ groovy ËÑöÊú¨Â§çÂà∂Âà∞ÂàùÂßãÂåñÊñá‰ª∂Â§πÂÜÖ„ÄÇ</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> executors.groovy /usr/share/jenkins/ref/init.groovy.d/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> default-user.groovy /usr/share/jenkins/ref/init.groovy.d/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># ÊåÇËΩΩ jenkins_home ÁõÆÂΩïÂà∞ Docker Âç∑„ÄÇ</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">VOLUME</span><span class="s"> /var/jenkins_home</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Êé•ÁùÄÊàë‰ª¨ÈÄöËøáÂëΩ‰ª§ÊûÑÂª∫Âá∫ Master ÈïúÂÉè„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker build -t jenkins-master .
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/jenkins-combines-docker-to-implement-low-level-ci/1569310062770.png"
	width="1687"
	height="710"
	srcset="/p/jenkins-combines-docker-to-implement-low-level-ci/1569310062770_hua4416823c569a0be8dd13b651cc3078f_195504_480x0_resize_box_3.png 480w, /p/jenkins-combines-docker-to-implement-low-level-ci/1569310062770_hua4416823c569a0be8dd13b651cc3078f_195504_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="1569310062770"
	
	
		class="gallery-image" 
		data-flex-grow="237"
		data-flex-basis="570px"
	
></p>
<h3 id="12-ÊûÑÂª∫-slave-ÈïúÂÉè">1.2 ÊûÑÂª∫ Slave ÈïúÂÉè</h3>
<p>Slave ÈïúÂÉèÁöÑÊ†∏ÂøÉÊòØ‰∏Ä‰∏™ <code>slave.py</code> ÁöÑ python ËÑöÊú¨ÔºåÂÆÉ‰∏ªË¶ÅÊâßË°åÁöÑÂä®‰ΩúÊòØËøêË°å <code>slave.jar</code> Âπ∂Âíå Master Âª∫Á´ãÈÄö‰ø°ÔºåËøôÊ†∑‰Ω†ÁöÑÁÆ°ÈÅì‰ªªÂä°Â∞±ËÉΩÂ§ü‰∫§Áªô Slave ËøõË°åÊâßË°å„ÄÇËøô‰∏™ËÑöÊú¨ÊâÄÂÅöÁöÑÂ∑•‰ΩúÊµÅÁ®ãÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">st=&gt;start: ËÑöÊú¨ÊâßË°å
</span></span><span class="line"><span class="cl">stop=&gt;end: ÂÆπÂô®ÂÅúÊ≠¢
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">op1=&gt;operation: ÂØºÂÖ• &#34;jenkins&#34; ÁöÑ python Ê®°Âùó
</span></span><span class="line"><span class="cl">op2=&gt;operation: Á≠âÂæÖ Master ÂêØÂä®
</span></span><span class="line"><span class="cl">cond1=&gt;condition: Master ÊòØÂê¶ÂèØÁî®
</span></span><span class="line"><span class="cl">op3=&gt;operation: ‰∏ãËΩΩ slave.jar Êñá‰ª∂Âà∞ÂÆπÂô®ÂÜÖ
</span></span><span class="line"><span class="cl">op4=&gt;operation: ÈÄöËøá JLNP ËøûÊé•Âà∞ Master ËäÇÁÇπ
</span></span><span class="line"><span class="cl">op5=&gt;operation: ‰ΩøÁî®Âá≠ÊçÆÈÄöËøáÊéàÊùÉÈ™åËØÅ
</span></span><span class="line"><span class="cl">op6=&gt;operation: ÊàêÂäüËøêË°å Slave
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">st-&gt;op1-&gt;op2-&gt;cond1
</span></span><span class="line"><span class="cl">cond1(no)-&gt;op2
</span></span><span class="line"><span class="cl">cond1(yes)-&gt;op3-&gt;op4-&gt;op5-&gt;op6-&gt;stop
</span></span></code></pre></td></tr></table>
</div>
</div><p>Êàë‰ª¨ÂÜçÂª∫Á´ã‰∏Ä‰∏™ slave Êñá‰ª∂Â§πÔºåÂπ∂‰ΩøÁî® <code>vi</code> Â∞Ü python ËÑöÊú¨Â§çÂà∂ËøõÂéª„ÄÇ</p>
<p><code>slave.py</code> ÁöÑÂÜÖÂÆπÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">jenkins</span> <span class="kn">import</span> <span class="n">Jenkins</span><span class="p">,</span> <span class="n">JenkinsError</span><span class="p">,</span> <span class="n">NodeLaunchMethod</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">signal</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">urllib</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">subprocess</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">shutil</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">slave_jar</span> <span class="o">=</span> <span class="s1">&#39;/var/lib/jenkins/slave.jar&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">slave_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;SLAVE_NAME&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;SLAVE_NAME&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="s1">&#39;docker-slave-&#39;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOSTNAME&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">jnlp_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;JENKINS_URL&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/computer/&#39;</span> <span class="o">+</span> <span class="n">slave_name</span> <span class="o">+</span> <span class="s1">&#39;/slave-agent.jnlp&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">slave_jar_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;JENKINS_URL&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/jnlpJars/slave.jar&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">slave_jar_url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">process</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">clean_dir</span><span class="p">(</span><span class="nb">dir</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="nb">dir</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">d</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">slave_create</span><span class="p">(</span><span class="n">node_name</span><span class="p">,</span> <span class="n">working_dir</span><span class="p">,</span> <span class="n">executors</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">j</span> <span class="o">=</span> <span class="n">Jenkins</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;JENKINS_URL&#39;</span><span class="p">],</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;JENKINS_USER&#39;</span><span class="p">],</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;JENKINS_PASS&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">j</span><span class="o">.</span><span class="n">node_create</span><span class="p">(</span><span class="n">node_name</span><span class="p">,</span> <span class="n">working_dir</span><span class="p">,</span> <span class="n">num_executors</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">executors</span><span class="p">),</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">,</span> <span class="n">launcher</span> <span class="o">=</span> <span class="n">NodeLaunchMethod</span><span class="o">.</span><span class="n">JNLP</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">slave_delete</span><span class="p">(</span><span class="n">node_name</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">j</span> <span class="o">=</span> <span class="n">Jenkins</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;JENKINS_URL&#39;</span><span class="p">],</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;JENKINS_USER&#39;</span><span class="p">],</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;JENKINS_PASS&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">j</span><span class="o">.</span><span class="n">node_delete</span><span class="p">(</span><span class="n">node_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">slave_download</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">slave_jar</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">slave_jar</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">loader</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">URLopener</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">loader</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;JENKINS_URL&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/jnlpJars/slave.jar&#39;</span><span class="p">,</span> <span class="s1">&#39;/var/lib/jenkins/slave.jar&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">slave_run</span><span class="p">(</span><span class="n">slave_jar</span><span class="p">,</span> <span class="n">jnlp_url</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">params</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;java&#39;</span><span class="p">,</span> <span class="s1">&#39;-jar&#39;</span><span class="p">,</span> <span class="n">slave_jar</span><span class="p">,</span> <span class="s1">&#39;-jnlpUrl&#39;</span><span class="p">,</span> <span class="n">jnlp_url</span> <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;JENKINS_SLAVE_ADDRESS&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">params</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span> <span class="s1">&#39;-connectTo&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;JENKINS_SLAVE_ADDRESS&#39;</span> <span class="p">]</span> <span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;SLAVE_SECRET&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">params</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span> <span class="s1">&#39;-jnlpCredentials&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;JENKINS_USER&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;JENKINS_PASS&#39;</span><span class="p">]</span> <span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">params</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span> <span class="s1">&#39;-secret&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;SLAVE_SECRET&#39;</span><span class="p">]</span> <span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">signal_handler</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">process</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">process</span><span class="o">.</span><span class="n">send_signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="n">signal_handler</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGTERM</span><span class="p">,</span> <span class="n">signal_handler</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">master_ready</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="n">requests</span><span class="o">.</span><span class="n">codes</span><span class="o">.</span><span class="n">ok</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="ow">not</span> <span class="n">master_ready</span><span class="p">(</span><span class="n">slave_jar_url</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Master not ready yet, sleeping for 10sec!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">slave_download</span><span class="p">(</span><span class="n">slave_jar</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span> <span class="s1">&#39;Downloaded Jenkins slave jar.&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;SLAVE_WORING_DIR&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">    <span class="n">os</span><span class="o">.</span><span class="n">setcwd</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;SLAVE_WORING_DIR&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CLEAN_WORKING_DIR&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;true&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">clean_dir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span> <span class="s2">&#34;Cleaned up working directory.&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;SLAVE_NAME&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">slave_create</span><span class="p">(</span><span class="n">slave_name</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;SLAVE_EXECUTORS&#39;</span><span class="p">],</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;SLAVE_LABELS&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span> <span class="s1">&#39;Created temporary Jenkins slave.&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">process</span> <span class="o">=</span> <span class="n">slave_run</span><span class="p">(</span><span class="n">slave_jar</span><span class="p">,</span> <span class="n">jnlp_url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span> <span class="s1">&#39;Started Jenkins slave with name &#34;&#39;</span> <span class="o">+</span> <span class="n">slave_name</span> <span class="o">+</span> <span class="s1">&#39;&#34; and labels [&#39;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;SLAVE_LABELS&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;].&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">process</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span> <span class="s1">&#39;Jenkins slave stopped.&#39;</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;SLAVE_NAME&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">slave_delete</span><span class="p">(</span><span class="n">slave_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span> <span class="s1">&#39;Removed temporary Jenkins slave.&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰∏äËø∞ËÑöÊú¨ÁöÑÂ∑•‰ΩúÂü∫Êú¨‰∏éÊµÅÁ®ãÂõæÁöÑ‰∏ÄËá¥ÔºåÂõ†‰∏∫ Jenkins ÈíàÂØπ Python Êèê‰æõ‰∫Ü SDK ÔºåÊâÄ‰ª•Âéü‰ΩúËÄÖ‰ΩøÁî® Python Êù•ÁºñÂÜôÁöÑ ‚Äú‰ª£ÁêÜ‚Äù Á®ãÂ∫è„ÄÇ‰∏çËøá Jenkins ‰πüÊúâ RESTful APIÔºå‰Ω†‰πüÂèØ‰ª•‰ΩøÁî® .NET Core ÁºñÂÜôÁ±ª‰ººÁöÑ ‚Äú‰ª£ÁêÜ‚Äù Á®ãÂ∫è„ÄÇ</p>
<p>Êé•ÁùÄÊàë‰ª¨Êù•ÁºñÂÜô Slave ÈïúÂÉèÁöÑ Dockerfile Êñá‰ª∂ÔºåÂõ†‰∏∫ÂõΩÂÜÖÊúçÂä°Âô®ËÆøÈóÆ Ubuntu ÁöÑÊ∫êÂæàÊÖ¢ÔºåÁªèÂ∏∏Âõ†‰∏∫Ë∂ÖÊó∂ÂØºËá¥ÊûÑÂª∫Â§±Ë¥•ÔºåËøôÈáåÂàáÊç¢Êàê‰∫ÜÈòøÈáå‰∫ëÁöÑÊ∫êÔºåÂÖ∂ÂÜÖÂÆπÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="k">FROM</span><span class="s"> ubuntu:16.04</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span> <span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># ÂÆâË£Ö Docker CLI„ÄÇ</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> sed -i s@/archive.ubuntu.com/@/mirrors.aliyun.com/@g /etc/apt/sources.list <span class="o">&amp;&amp;</span> apt-get clean<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> apt-get update --fix-missing <span class="o">&amp;&amp;</span> apt-get install -y apt-transport-https ca-certificates curl openjdk-8-jre python python-pip git<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># ‰ΩøÁî®ÈòøÈáå‰∫ëÁöÑÈïúÂÉèÊ∫ê„ÄÇ</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg <span class="p">|</span> apt-key add -<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> <span class="nb">echo</span> <span class="s2">&#34;deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu xenial stable&#34;</span> &gt; /etc/apt/sources.list.d/docker.list<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> apt-get update --fix-missing <span class="o">&amp;&amp;</span> apt-get install -y docker-ce --allow-unauthenticated<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> easy_install jenkins-webapi<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># ÂÆâË£Ö Docker-Compose Â∑•ÂÖ∑„ÄÇ</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> curl -L https://github.com/docker/compose/releases/download/1.21.2/docker-compose-<span class="sb">`</span>uname -s<span class="sb">`</span>-<span class="sb">`</span>uname -m<span class="sb">`</span> &gt; /usr/local/bin/docker-compose <span class="o">&amp;&amp;</span> chmod +x /usr/local/bin/docker-compose<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> mkdir -p /home/jenkins<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> mkdir -p /var/lib/jenkins<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Â∞Ü slave.py Êñá‰ª∂Ê∑ªÂä†Âà∞ÂÆπÂô®„ÄÇ</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ADD</span> slave.py /var/lib/jenkins/slave.py<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">WORKDIR</span><span class="s"> /home/jenkins</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># ÈÖçÁΩÆ Jenkins Master ÁöÑ‰∏Ä‰∫õËøûÊé•ÂèÇÊï∞Âíå Slave ‰ø°ÊÅØ„ÄÇ</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENV</span> JENKINS_URL <span class="s2">&#34;http://jenkins&#34;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENV</span> JENKINS_SLAVE_ADDRESS <span class="s2">&#34;&#34;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENV</span> JENKINS_USER <span class="s2">&#34;admin&#34;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENV</span> JENKINS_PASS <span class="s2">&#34;admin&#34;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENV</span> SLAVE_NAME <span class="s2">&#34;&#34;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENV</span> SLAVE_SECRET <span class="s2">&#34;&#34;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENV</span> SLAVE_EXECUTORS <span class="s2">&#34;1&#34;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENV</span> SLAVE_LABELS <span class="s2">&#34;docker&#34;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENV</span> SLAVE_WORING_DIR <span class="s2">&#34;&#34;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENV</span> CLEAN_WORKING_DIR <span class="s2">&#34;true&#34;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span> <span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span> <span class="s2">&#34;python&#34;</span><span class="p">,</span> <span class="s2">&#34;-u&#34;</span><span class="p">,</span> <span class="s2">&#34;/var/lib/jenkins/slave.py&#34;</span> <span class="p">]</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ÁªßÁª≠‰ΩøÁî® <code>docker build</code> ÊûÑÂª∫ Slave ÈïúÂÉèÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker build -t jenkins-slave .
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="13-ÁºñÂÜô-docker-compose-Êñá‰ª∂">1.3 ÁºñÂÜô Docker Compose Êñá‰ª∂</h3>
<p>ËøôÈáåÁöÑ Docker Compose Êñá‰ª∂ÔºåÊàëÂèñÂêçÂè´ <code>docker-compose.jenkins.yaml</code> Ôºå‰∏ªË¶ÅÂ∑•‰ΩúÊòØ‰∏∫‰∫ÜÂêØÂä® Master Âíå Slave ÂÆπÂô®„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;3.1&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">jenkins</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">jenkins</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s1">&#39;8080:8080&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s1">&#39;50000:50000&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">jenkins-master</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">jenkins-slave</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">jenkins-slave</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l">always</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s1">&#39;JENKINS_URL=http://jenkins:8080&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">jenkins-slave</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="l">/var/run/docker.sock:/var/run/docker.sock </span><span class="w"> </span><span class="c"># Â∞ÜÂÆø‰∏ªÊú∫ÁöÑ Docker Daemon ÊåÇËΩΩÂà∞ÂÆπÂô®ÂÜÖÈÉ®„ÄÇ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="l">/home/jenkins:/home/jenkins</span><span class="w"> </span><span class="c"># Â∞ÜÊï∞ÊçÆÊåÇËΩΩÂá∫Êù•ÔºåÊñπ‰æøÂêéÁª≠ËøõË°åÈáäÊîæ„ÄÇ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">depends_on</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="l">jenkins</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ÊâßË°å Docker Compose ‰πãÂêéÔºåÊàë‰ª¨ÈÄöËøá <code>ÂÆø‰∏ªÊú∫ IP:8080</code> Â∞±ÂèØ‰ª•ËÆøÈóÆÂà∞ Jenkins ÂÜÖÈÉ®‰∫ÜÔºåÂ¶Ç‰∏ãÂõæ„ÄÇ</p>
<p><img src="/p/jenkins-combines-docker-to-implement-low-level-ci/1569317919395.png"
	width="3840"
	height="1877"
	srcset="/p/jenkins-combines-docker-to-implement-low-level-ci/1569317919395_huf468a4d59467a253cefa6dcd361e50c2_80151_480x0_resize_box_3.png 480w, /p/jenkins-combines-docker-to-implement-low-level-ci/1569317919395_huf468a4d59467a253cefa6dcd361e50c2_80151_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="1569317919395"
	
	
		class="gallery-image" 
		data-flex-grow="204"
		data-flex-basis="490px"
	
></p>
<h2 id="‰∫ågogs-ÁöÑÈÉ®ÁΩ≤">‰∫å„ÄÅGogs ÁöÑÈÉ®ÁΩ≤</h2>
<p>Êàë‰ª¨ÂÜÖÈÉ®ÂºÄÂèë‰ΩøÁî®ÁöÑ Git ‰ªìÂ∫ìÊòØ‰ΩøÁî® Gogs ËøõË°åÊê≠Âª∫ÁöÑÔºåGogs ÂÆòÊñπÊèê‰æõ‰∫Ü Docker ÈïúÂÉèÔºåÈÇ£Êàë‰ª¨ÂèØ‰ª•Áõ¥Êé•ÁºñÂÜô‰∏Ä‰∏™ Docker Compose Âø´ÈÄüÈÉ®ÁΩ≤ Gogs„ÄÇ</p>
<p><code>docker-compose.gogs.yaml</code> Êñá‰ª∂ÂÜÖÂÆπÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;3.1&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">gogs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">gogs/gogs</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;gogs&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">expose</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s1">&#39;3000:3000&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">expose</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">22</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">/var/lib/docker/Persistence/Gogs:/data	# ÊåÇËΩΩÊï∞ÊçÆÂç∑„ÄÇ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l">always</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ÊâßË°å‰ª•‰∏ãÂëΩ‰ª§ÂêéÔºåÂç≥ÂèØÂêØÂä® Gogs Á®ãÂ∫èÔºåËÆøÈóÆ <code>ÂÆø‰∏ªÊú∫ IP:3000</code> ÊåâÁÖßÈÖçÁΩÆËØ¥ÊòéÂÆâË£Ö Gogs Âç≥ÂèØÔºå‰πãÂêé‰Ω†Â∞±ÂèØ‰ª•ÂàõÂª∫ËøúÁ®ã‰ªìÂ∫ì‰∫Ü„ÄÇ</p>
<p><img src="/p/jenkins-combines-docker-to-implement-low-level-ci/1569309071060.png"
	width="2482"
	height="1591"
	srcset="/p/jenkins-combines-docker-to-implement-low-level-ci/1569309071060_hu0fdd500473f20cf8c47d71376dbeba69_248403_480x0_resize_box_3.png 480w, /p/jenkins-combines-docker-to-implement-low-level-ci/1569309071060_hu0fdd500473f20cf8c47d71376dbeba69_248403_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="1569309071060"
	
	
		class="gallery-image" 
		data-flex-grow="156"
		data-flex-basis="374px"
	
></p>
<h2 id="‰∏âgogs-‰∏é-jenkins-ÁöÑÈõÜÊàê">‰∏â„ÄÅGogs ‰∏é Jenkins ÁöÑÈõÜÊàê</h2>
<p>ËôΩÁÑ∂Â§ßÈÉ®ÂàÜÈÉΩÊé®Ëçê Jenkins ÁöÑ Gogs Webhook Êèí‰ª∂Ôºå‰∏çËøáËøô‰∏™Êèí‰ª∂Âæà‰πÖ‰∏çÊõ¥Êñ∞‰∫ÜÔºåËÄå‰∏î‰∏çÊîØÊåÅ <strong>ÁâàÊú¨ÂèëÂ∏É</strong> ‰∫ã‰ª∂„ÄÇÈíàÂØπ‰∫éËØ•ÈóÆÈ¢òËôΩÁÑ∂ÂÆòÊñπÊúâ <a class="link" href="https://github.com/jenkinsci/gogs-webhook-plugin/pull/62"  target="_blank" rel="noopener"
    >PR #62</a>Ôºå‰ΩÜ‰∏ÄÁõ¥Ê≤°ÊúâÂêàÂπ∂ÔºåÁ≠âÂà∞ÂêàÂπ∂ÁöÑÊó∂ÂÄôÈÉΩÊòØÁå¥Âπ¥È©¨Êúà‰∫Ü„ÄÇËøôÈáåËøòÊòØÂª∫ËÆÆ‰ΩøÁî® <strong>Generic Webhook Trigger</strong> ÔºåÁî®Ëøô‰∏™Êèí‰ª∂Êù•Ëß¶Âèë Jenkins ÁöÑÁÆ°ÈÅì‰ªªÂä°„ÄÇ</p>
<h3 id="31-ÂàõÂª∫ÊµÅÊ∞¥Á∫øÈ°πÁõÆ">3.1 ÂàõÂª∫ÊµÅÊ∞¥Á∫øÈ°πÁõÆ</h3>
<p>È¶ñÂÖàÊâæÂà∞ Jenkins ÁöÑÊèí‰ª∂‰∏≠ÂøÉÔºåÊêúÁ¥¢ Generic Webhook Trigger Êèí‰ª∂ÔºåÂπ∂ËøõË°åÂÆâË£Ö„ÄÇ</p>
<p><img src="/p/jenkins-combines-docker-to-implement-low-level-ci/20190924210101.gif"
	width="1920"
	height="882"
	srcset="/p/jenkins-combines-docker-to-implement-low-level-ci/20190924210101_hud4323201595f837ed2c008c2975e63cc_1360368_480x0_resize_box_1.gif 480w, /p/jenkins-combines-docker-to-implement-low-level-ci/20190924210101_hud4323201595f837ed2c008c2975e63cc_1360368_1024x0_resize_box_1.gif 1024w"
	loading="lazy"
	
		alt="20190924210101"
	
	
		class="gallery-image" 
		data-flex-grow="217"
		data-flex-basis="522px"
	
></p>
<p>ÁªßÁª≠Êñ∞Âª∫‰∏Ä‰∏™ÁÆ°ÈÅì‰ªªÂä°ÔºåÂèñÂêçÂè´ÂÅö TestProjectÔºåÁ±ªÂûãÈÄâÊã© Pipeline „ÄÇ</p>
<p><img src="/p/jenkins-combines-docker-to-implement-low-level-ci/20190924210701.gif"
	width="1920"
	height="623"
	srcset="/p/jenkins-combines-docker-to-implement-low-level-ci/20190924210701_hu3435afd9011b083822ed8b3e00d1574a_284015_480x0_resize_box_1.gif 480w, /p/jenkins-combines-docker-to-implement-low-level-ci/20190924210701_hu3435afd9011b083822ed8b3e00d1574a_284015_1024x0_resize_box_1.gif 1024w"
	loading="lazy"
	
		alt="20190924210701"
	
	
		class="gallery-image" 
		data-flex-grow="308"
		data-flex-basis="739px"
	
></p>
<p>È¶ñÂÖàÈÖçÁΩÆÈ°πÁõÆÁöÑÊï∞ÊçÆÊù•Ê∫êÔºåÈÄâÊã© SCMÔºåÂπ∂‰∏îÈÖçÁΩÆ Git ËøúÁ®ã‰ªìÂ∫ìÁöÑÂú∞ÂùÄÔºåÂ¶ÇÊûúÊòØÁßÅÊúâ‰ªìÂ∫ìÂàôËøòÈúÄË¶ÅËÆæÁΩÆÁî®Êà∑ÂêçÂíåÂØÜÁ†Å„ÄÇ</p>
<p><img src="/p/jenkins-combines-docker-to-implement-low-level-ci/1569330833479.png"
	width="2886"
	height="1498"
	srcset="/p/jenkins-combines-docker-to-implement-low-level-ci/1569330833479_huf375df774c6d8359d4b998504cf49c2b_267894_480x0_resize_box_3.png 480w, /p/jenkins-combines-docker-to-implement-low-level-ci/1569330833479_huf375df774c6d8359d4b998504cf49c2b_267894_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="1569330833479"
	
	
		class="gallery-image" 
		data-flex-grow="192"
		data-flex-basis="462px"
	
></p>
<p><img src="/p/jenkins-combines-docker-to-implement-low-level-ci/1569330858800.png"
	width="2873"
	height="1092"
	srcset="/p/jenkins-combines-docker-to-implement-low-level-ci/1569330858800_hu2a8b18bb77abc4f7894f60818761fabe_117614_480x0_resize_box_3.png 480w, /p/jenkins-combines-docker-to-implement-low-level-ci/1569330858800_hu2a8b18bb77abc4f7894f60818761fabe_117614_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="1569330858800"
	
	
		class="gallery-image" 
		data-flex-grow="263"
		data-flex-basis="631px"
	
></p>
<p><img src="/p/jenkins-combines-docker-to-implement-low-level-ci/1569330897596.png"
	width="1854"
	height="275"
	srcset="/p/jenkins-combines-docker-to-implement-low-level-ci/1569330897596_hucbde5b5a5a9c898ea35a2aaf23443bff_37749_480x0_resize_box_3.png 480w, /p/jenkins-combines-docker-to-implement-low-level-ci/1569330897596_hucbde5b5a5a9c898ea35a2aaf23443bff_37749_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="1569330897596"
	
	
		class="gallery-image" 
		data-flex-grow="674"
		data-flex-basis="1618px"
	
></p>
<h3 id="32-jenkins-ÁöÑ-webhook-ÈÖçÁΩÆ">3.2 Jenkins ÁöÑ Webhook ÈÖçÁΩÆ</h3>
<p>ÊµÅÊ∞¥Á∫øÈ°πÁõÆÂª∫Á´ãÂÆåÊàêÂêéÔºåÊàë‰ª¨Â∞±ÂèØ‰ª•ÂºÄÂßãËÆæÁΩÆ Generic WebHook Trigger ÁöÑ‰∏Ä‰∫õÂèÇÊï∞Ôºå‰ª•‰æøËÆ©ËøúÁ®ãÁöÑ Gogs ËÉΩÂ§üËß¶ÂèëÊûÑÂª∫‰ªªÂä°„ÄÇ</p>
<p><img src="/p/jenkins-combines-docker-to-implement-low-level-ci/1569331415017.png"
	width="2924"
	height="646"
	srcset="/p/jenkins-combines-docker-to-implement-low-level-ci/1569331415017_hud2284df3cf1724649a123ca347391870_88867_480x0_resize_box_3.png 480w, /p/jenkins-combines-docker-to-implement-low-level-ci/1569331415017_hud2284df3cf1724649a123ca347391870_88867_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="1569331415017"
	
	
		class="gallery-image" 
		data-flex-grow="452"
		data-flex-basis="1086px"
	
></p>
<p>Êàë‰ª¨‰∏∫ TestProject ÂàõÂª∫‰∏Ä‰∏™ TokenÔºåËøô‰∏™ Token ÊòØË∑üÊµÅÊ∞¥Á∫ø‰ªªÂä°ÁªëÂÆö‰∫ÜÔºåËØ¥ÁôΩ‰∫ÜÂ∞±ÊòØÊµÅÊ∞¥Á∫ø‰ªªÂä°ÁöÑ‰∏Ä‰∏™Ê†áËØÜ„ÄÇÂª∫ËÆÆ‰ΩøÁî®ÈöèÊú∫ Guid ‰Ωú‰∏∫ TokenÔºå‰∏çÁÑ∂ÂÖ∂‰ªñ‰∫∫ÈÉΩÂèØ‰ª•Èöè‰æøËß¶Âèë‰Ω†ÁöÑÊµÅÊ∞¥Á∫ø‰ªªÂä°ËøõË°åÊûÑÂª∫‰∫Ü„ÄÇ</p>
<p><img src="/p/jenkins-combines-docker-to-implement-low-level-ci/1569334122415.png"
	width="2865"
	height="1530"
	srcset="/p/jenkins-combines-docker-to-implement-low-level-ci/1569334122415_hu26f931aa342f51c8c56adfa84b9ab9a5_300448_480x0_resize_box_3.png 480w, /p/jenkins-combines-docker-to-implement-low-level-ci/1569334122415_hu26f931aa342f51c8c56adfa84b9ab9a5_300448_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="1569334122415"
	
	
		class="gallery-image" 
		data-flex-grow="187"
		data-flex-basis="449px"
	
></p>
<h3 id="33-gogs-ÁöÑ-webhook-ÈÖçÁΩÆ">3.3 Gogs ÁöÑ Webhook ÈÖçÁΩÆ</h3>
<p>Êé•ÁùÄÊù•Âà∞ÂàöÂàöÊàë‰ª¨Âª∫Â•ΩÁöÑ‰ªìÂ∫ìÔºåÊâæÂà∞ <strong>‰ªìÂ∫ìËÆæÁΩÆ-&gt;ÁÆ°ÁêÜ Web Èí©Â≠ê-&gt;Ê∑ªÂä† Web Èí©Â≠ê-&gt;Gogs</strong> „ÄÇ</p>
<p><img src="/p/jenkins-combines-docker-to-implement-low-level-ci/1569311317013.png"
	width="2436"
	height="998"
	srcset="/p/jenkins-combines-docker-to-implement-low-level-ci/1569311317013_hu4dd11577ea45f4613396f553ec32a489_160767_480x0_resize_box_3.png 480w, /p/jenkins-combines-docker-to-implement-low-level-ci/1569311317013_hu4dd11577ea45f4613396f553ec32a489_160767_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="1569311317013"
	
	
		class="gallery-image" 
		data-flex-grow="244"
		data-flex-basis="585px"
	
></p>
<p><img src="/p/jenkins-combines-docker-to-implement-low-level-ci/1569331737902.png"
	width="2155"
	height="1869"
	srcset="/p/jenkins-combines-docker-to-implement-low-level-ci/1569331737902_hu0fb3ad5524967b89dfb8d01dc5415872_381628_480x0_resize_box_3.png 480w, /p/jenkins-combines-docker-to-implement-low-level-ci/1569331737902_hu0fb3ad5524967b89dfb8d01dc5415872_381628_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="1569331737902"
	
	
		class="gallery-image" 
		data-flex-grow="115"
		data-flex-basis="276px"
	
></p>
<p>Âõ†‰∏∫Ëß¶ÂèëÊûÑÂª∫‰∏çÂèØËÉΩÊØèÊ¨°Êèê‰∫§ÈÉΩËß¶ÂèëÔºå‰∏ÄËà¨Êù•ËØ¥ÈÉΩÊòØÂàõÂª∫‰∫ÜÊüê‰∏™ÂêàÂπ∂ËØ∑Ê±ÇÔºåÊàñËÄÖÂèëÂ∏ÉÊñ∞ÁâàÊú¨ÁöÑÊó∂ÂÄôÂ∞±‰ºöËß¶ÂèëÊµÅÊ∞¥Á∫ø‰ªªÂä°„ÄÇÂõ†Ê≠§ËøôÈáå‰Ω†ÂèØ‰ª•Ê†πÊçÆËá™Â∑±ÁöÑÊÉÖÂÜµÊù•ÈÄâÊã©Ëß¶Âèë‰∫ã‰ª∂ÔºåËøôÈáåÊàë‰ª•ÂêàÂπ∂ËØ∑Ê±Ç‰∏∫‰æãÔºå‰Ω†ÂèØ‰ª•Âú®Èí©Â≠êËÆæÁΩÆÈ°µÈù¢ÁÇπÂáª <strong>ÊµãËØïÊé®ÈÄÅ</strong>„ÄÇËøôÊ†∑Â∞±ÂèØ‰ª•ÁúãÂà∞ Gogs ÂèëÈÄÅÁªô Jenkins ÁöÑ JSON ÁªìÊûÑÊòØÊÄéÊ†∑ÁöÑÔºå‰Ω†Â∞±ËÉΩÂ§üÂú® Jenkins ÈÇ£ËæπÊúâÊù°‰ª∂ÁöÑËøõË°åÂ§ÑÁêÜ„ÄÇ</p>
<p><img src="/p/jenkins-combines-docker-to-implement-low-level-ci/1569331889328.png"
	width="1581"
	height="649"
	srcset="/p/jenkins-combines-docker-to-implement-low-level-ci/1569331889328_hu6030bfb72df541ba091fd7c66f62c796_61601_480x0_resize_box_3.png 480w, /p/jenkins-combines-docker-to-implement-low-level-ci/1569331889328_hu6030bfb72df541ba091fd7c66f62c796_61601_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="1569331889328"
	
	
		class="gallery-image" 
		data-flex-grow="243"
		data-flex-basis="584px"
	
></p>
<p>‰∏çËøáÊµãËØïÊé®ÈÄÅÂè™ËÉΩÂ§üÈíàÂØπÊôÆÈÄöÁöÑ push ‰∫ã‰ª∂ËøõË°åÊµãËØïÔºåÂÉè <strong>ÂêàÂπ∂ËØ∑Ê±Ç</strong> ÊàñËÄÖ <strong>ÁâàÊú¨ÂèëÂ∏É</strong> ËøôÁßç‰∫ã‰ª∂Âè™ËÉΩËá™Â∑±Ê®°ÊãüÊìç‰Ωú‰∫Ü„ÄÇÂú®ËøôÈáåÊàëÊñ∞Âª∫‰∫Ü‰∏Ä‰∏™Áî®Êà∑ÔºåFork ‰∫ÜÂè¶‰∏Ä‰∏™Â∏êÂè∑Âª∫Á´ãÁöÑ TestProject ‰ªìÂ∫ì„ÄÇ</p>
<p><img src="/p/jenkins-combines-docker-to-implement-low-level-ci/1569333744053.png"
	width="2049"
	height="1008"
	srcset="/p/jenkins-combines-docker-to-implement-low-level-ci/1569333744053_hufe8f55118e891bd0117265ad5014f6a0_184477_480x0_resize_box_3.png 480w, /p/jenkins-combines-docker-to-implement-low-level-ci/1569333744053_hufe8f55118e891bd0117265ad5014f6a0_184477_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="1569333744053"
	
	
		class="gallery-image" 
		data-flex-grow="203"
		data-flex-basis="487px"
	
></p>
<p>Âú® Fork ÁöÑ‰ªìÂ∫ìÈáåÈù¢ÔºåÊàëÊñ∞Âª∫‰∫Ü‰∏Ä‰∏™ Readme.md Êñá‰ª∂ÔºåÁÑ∂ÂêéÁÇπÂáªÂàõÂª∫ÂêàÂπ∂ÔºåËøô‰∏™Êó∂ÂÄô‰Ω†Áúã Gogs ÁöÑ WebHook Êé®ÈÄÅËÆ∞ÂΩïÂ∞±Êúâ‰∏ÄÊù°Êñ∞ÁöÑÊï∞ÊçÆÊé®ÈÄÅÁªô JenkinsÔºåÂêåÊó∂‰Ω†‰πüÂèØ‰ª•Âú® Jenkins ÁúãÂà∞ÊµÅÊ∞¥Á∫ø‰ªªÂä°Ë¢´Ëß¶Âèë‰∫Ü„ÄÇ</p>
<p><img src="/p/jenkins-combines-docker-to-implement-low-level-ci/1569333872900.png"
	width="2339"
	height="1509"
	srcset="/p/jenkins-combines-docker-to-implement-low-level-ci/1569333872900_hu4e24f3ba2f2b3df865e4035f27c70f58_136895_480x0_resize_box_3.png 480w, /p/jenkins-combines-docker-to-implement-low-level-ci/1569333872900_hu4e24f3ba2f2b3df865e4035f27c70f58_136895_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="1569333872900"
	
	
		class="gallery-image" 
		data-flex-grow="155"
		data-flex-basis="372px"
	
></p>
<p><img src="/p/jenkins-combines-docker-to-implement-low-level-ci/1569333943683.png"
	width="1635"
	height="1650"
	srcset="/p/jenkins-combines-docker-to-implement-low-level-ci/1569333943683_huee82677301f48e64d8c4dbdb2ff39299_217576_480x0_resize_box_3.png 480w, /p/jenkins-combines-docker-to-implement-low-level-ci/1569333943683_huee82677301f48e64d8c4dbdb2ff39299_217576_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="1569333943683"
	
	
		class="gallery-image" 
		data-flex-grow="99"
		data-flex-basis="237px"
	
></p>
<p><img src="/p/jenkins-combines-docker-to-implement-low-level-ci/1569333895518.png"
	width="1382"
	height="1211"
	srcset="/p/jenkins-combines-docker-to-implement-low-level-ci/1569333895518_hudc7b8ceb3619443fe25a75fdd362b699_206931_480x0_resize_box_3.png 480w, /p/jenkins-combines-docker-to-implement-low-level-ci/1569333895518_hudc7b8ceb3619443fe25a75fdd362b699_206931_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="1569333895518"
	
	
		class="gallery-image" 
		data-flex-grow="114"
		data-flex-basis="273px"
	
></p>
<h3 id="34-ÈôêÂÆö‰ªªÂä°Ëß¶ÂèëÊù°‰ª∂">3.4 ÈôêÂÆö‰ªªÂä°Ëß¶ÂèëÊù°‰ª∂</h3>
<p>ÈÄöËøá‰∏äÈù¢ÁöÑÊ≠•È™§ÔºåÊàë‰ª¨Â∑≤ÁªèÂ∞Ü Gogs Âíå Jenkins ‰∏≠ÁöÑÂÖ∑‰Ωì‰ªªÂä°ËøõË°å‰∫ÜÁªëÂÆö„ÄÇ‰∏çËøáËøòÊúâ‰∏Ä‰∏™ÊØîËæÉÂ∞¥Â∞¨ÁöÑÈóÆÈ¢òÊòØÔºåGogs ÁöÑÂêàÂπ∂‰∫ã‰ª∂‰∏ç‰ªÖ‰ªÖÂåÖÊã¨ÂàõÂª∫ÂêàÂπ∂ÔºåÂÆÉÁöÑÂéüÂßãÊèèËø∞ÊòØËøôÊ†∑ËØ¥ÁöÑ„ÄÇ</p>
<blockquote>
<p>ÂêàÂπ∂ËØ∑Ê±Ç‰∫ã‰ª∂ÂåÖÊã¨ÂêàÂπ∂Ë¢´ÂºÄÂêØ„ÄÅÂÖ≥Èó≠„ÄÅÈáçÊñ∞ÂºÄÂêØ„ÄÅÁºñËæë„ÄÅÊåáÊ¥æ„ÄÅÂèñÊ∂àÊåáÊ¥æ„ÄÅÊõ¥Êñ∞Ê†áÁ≠æ„ÄÅÊ∏ÖÈô§Ê†áÁ≠æ„ÄÅËÆæÁΩÆÈáåÁ®ãÁ¢ë„ÄÅÂèñÊ∂àËÆæÁΩÆÈáåÁ®ãÁ¢ëÊàñ‰ª£Á†ÅÂêåÊ≠•„ÄÇ</p>
</blockquote>
<p>Â¶ÇÊûúÊàë‰ª¨‰ªÖ‰ªÖÊòØ‰æùÈù†‰∏äÈù¢ÁöÑÈÖçÁΩÆÔºåÈÇ£‰πà‰∏äËø∞ÊâÄÊúâË°å‰∏∫ÈÉΩ‰ºöËß¶ÂèëÊûÑÂª∫Êìç‰ΩúÔºåËøôËÇØÂÆö‰∏çÊòØÊàë‰ª¨ÊÉ≥Ë¶ÅÁöÑÊïàÊûú„ÄÇËøòÂ•Ω Generic Webhook ‰∏∫Êàë‰ª¨Êèê‰æõ‰∫ÜÂèòÈáèËé∑ÂèñÔºå‰ª•Âèä Webhook ËøáÊª§„ÄÇ</p>
<p>Êàë‰ª¨‰ªé Gogs ÂèëÂæÄ Jenkins ÁöÑËØ∑Ê±Ç‰∏≠ÂèØ‰ª•ÁúãÂà∞ÔºåÂú® JSON ÂÜÖÈÉ®ÂåÖÂê´‰∫Ü‰∏Ä‰∏™ <code>action</code> Â≠óÊÆµÔºåÈáåÈù¢Â∞±ÊòØÊú¨Ê¨°ÁöÑÊìç‰ΩúÊ†áËØÜ„ÄÇÈÇ£‰πàÊàë‰ª¨Â∞±ÂèØ‰ª•ÊÉ≥Âà∞ÈÄöËøáÂà§Êñ≠ <code>action</code> Â≠óÊÆµÊòØÂê¶Á≠â‰∫é <code>opened </code>Êù•Ëß¶ÂèëÊµÅÊ∞¥Á∫ø‰ªªÂä°„ÄÇ</p>
<p>È¶ñÂÖàÔºåÊàë‰ª¨Â¢ûÂä† 4 ‰∏™ <strong>Post content parameters</strong> ÂèÇÊï∞ÔºåÂàÜÂà´Ëé∑ÂèñÂà∞ Gogs ‰º†ÈÄíËøáÊù•ÁöÑ <code>action</code> Âíå PR ÁöÑ IdÔºåËøôÈáåÊàëËß£Èáä‰∏Ä‰∏ãÂá†‰∏™ÊñáÊú¨Ê°ÜÁöÑÊÑèÊÄù„ÄÇ</p>
<p><img src="/p/jenkins-combines-docker-to-implement-low-level-ci/1569335075858.png"
	width="2796"
	height="1006"
	srcset="/p/jenkins-combines-docker-to-implement-low-level-ci/1569335075858_hub1d8addb29ac2db4259ecdf23bd05ac3_190077_480x0_resize_box_3.png 480w, /p/jenkins-combines-docker-to-implement-low-level-ci/1569335075858_hub1d8addb29ac2db4259ecdf23bd05ac3_190077_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="1569335075858"
	
	
		class="gallery-image" 
		data-flex-grow="277"
		data-flex-basis="667px"
	
></p>
<p>Èô§‰∫ÜËøô‰∏§‰∏™ Post ÂèÇÊï∞‰ª•Â§ñÔºåÂú®ËØ∑Ê±ÇÂ§¥‰∏≠ÔºåGogs ËøòÊê∫Â∏¶‰∫ÜÂÖ∑‰Ωì‰∫ã‰ª∂ÔºåÊàë‰ª¨Â∞ÜÂÖ∂‰∏ÄËµ∑‰Ωú‰∏∫ËøáÊª§Êù°‰ª∂„ÄÇ<strong>ÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºåÈíàÂØπ‰∫éËØ∑Ê±ÇÂ§¥ÁöÑÂèÇÊï∞ÔºåÂú®ËΩ¨Êç¢ÊàêÂèòÈáèÊó∂ÔºåÊèí‰ª∂‰ºöÂ∞ÜÂ≠óÁ¨¶ËΩ¨‰∏∫Â∞èÂÜôÔºåÂπ∂‰ºö‰ΩøÁî® &lsquo;_&rsquo; ‰ª£Êõø &lsquo;-&rsquo;„ÄÇ</strong></p>
<p><img src="/p/jenkins-combines-docker-to-implement-low-level-ci/1569335210285.png"
	width="2745"
	height="587"
	srcset="/p/jenkins-combines-docker-to-implement-low-level-ci/1569335210285_huf51df76435bbe6616e9b6282da9735f3_103070_480x0_resize_box_3.png 480w, /p/jenkins-combines-docker-to-implement-low-level-ci/1569335210285_huf51df76435bbe6616e9b6282da9735f3_103070_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="1569335210285"
	
	
		class="gallery-image" 
		data-flex-grow="467"
		data-flex-basis="1122px"
	
></p>
<p>ÊúÄÂêéÊàë‰ª¨ÁºñÂÜô‰∏Ä‰∏™ <strong>Optional filter</strong> ÔºåÂÆÉÁöÑ Expression ÂèÇÊï∞ÊòØÊ≠£ÂàôË°®ËææÂºèÔºå‰∏ãÈù¢ÁöÑ Text Âç≥ÊòØÊ∫êÂ≠óÁ¨¶‰∏≤„ÄÇÂÆûÁé∞ÂæàÁÆÄÂçïÔºåÂΩì Text ÈáåÈù¢ÁöÑÂÜÖÂÆπÊª°Ë∂≥Ê≠£ÂàôË°®ËææÂºèÁöÑÊó∂ÂÄôÔºåÂ∞±‰ºöËß¶ÂèëÊµÅÊ∞¥Á∫ø‰ªªÂä°„ÄÇ</p>
<p>ÊâÄ‰ª•Êàë‰ª¨ÁöÑ Text Â≠óÁ¨¶‰∏≤Â∞±ÊòØÁî±‰∏äÈù¢‰∏â‰∏™ÂèòÈáèÁöÑÂÄºÁªÑÊàêÔºåÁÑ∂ÂêéÂíåÊàë‰ª¨È¢ÑÊúüÁöÑÂÄºËøõË°åÂåπÈÖçÂç≥ÂèØ„ÄÇ</p>
<p><img src="/p/jenkins-combines-docker-to-implement-low-level-ci/1569335465457.png"
	width="2422"
	height="468"
	srcset="/p/jenkins-combines-docker-to-implement-low-level-ci/1569335465457_hu4f02a3d67ef3907121c5a6eeee390333_93947_480x0_resize_box_3.png 480w, /p/jenkins-combines-docker-to-implement-low-level-ci/1569335465457_hu4f02a3d67ef3907121c5a6eeee390333_93947_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="1569335465457"
	
	
		class="gallery-image" 
		data-flex-grow="517"
		data-flex-basis="1242px"
	
></p>
<blockquote>
<p>ÂΩìÁÑ∂Ôºå‰Ω†ËøòÊÉ≥Êï¥‰∏Ä‰∫õÊõ¥Âä†ÁÇ´ÈÖ∑ÁöÑÂäüËÉΩÔºåÂèØ‰ª•‰ΩøÁî® Jenkins Êèê‰æõÁöÑ Http Request ‰πãÁ±ªÁöÑÊèí‰ª∂„ÄÇÂõ†‰∏∫ Gogs Êèê‰æõ‰∫Ü API Êé•Âè£Ôºå‰Ω†Â∞±ÂèØ‰ª•Âú®ÊûÑÂª∫ÂÆåÊàê‰πãÂêéÔºåÂõûÂÜôÁªô GogsÔºåÁî®‰∫éÊèêÁ§∫ÊûÑÂª∫ÁªìÊûú„ÄÇ</p>
<p>ËøôÊ†∑ÁöÑËØùÔºåËøôÁßçÂäüËÉΩÂ∞±ÊúâÁÇπÂÉè Github ‰∏äÈù¢ÁöÑÊú∫Âô®‰∫∫Â∏êÂè∑‰∫Ü„ÄÇ</p>
</blockquote>
<h2 id="ÂõõÂÆåÊï¥ÁöÑÈ°πÁõÆÁ§∫‰æã">Âõõ„ÄÅÂÆåÊï¥ÁöÑÈ°πÁõÆÁ§∫‰æã</h2>
<p>Âú®‰∏ä‰∏ÄËäÇÊàë‰ª¨ÈÄöËøá Jenkins ÁöÑÊèí‰ª∂ÂÆåÊàê‰∫ÜËøúÁ®ã‰ªìÂ∫ìÊé®ÈÄÅÈÄöÁü•ÔºåÂΩìÊàë‰ª¨ÂêàÂπ∂‰ª£Á†ÅÊó∂ÔºåJenkins ‰ºöËá™Âä®Ëß¶ÂèëÊâßË°åÊàë‰ª¨ÁöÑÁÆ°ÈÅì‰ªªÂä°„ÄÇÊé•‰∏ãÊù•ÊàëÂ∞ÜÂª∫Á´ã‰∏Ä‰∏™ .NET Core È°πÁõÆÔºåËØ•È°πÁõÆÊã•Êúâ‰∏Ä‰∏™ ControllerÔºåÊé•Êî∂Âà∞ËØ∑Ê±Ç‰πãÂêéËæìÂá∫ ‚ÄúHello World‚Äù„ÄÇÈöèÂêé‰∏∫ËØ•È°πÁõÆÂª∫Á´ã‰∏Ä‰∏™ xUnit ÁöÑÊµãËØïÈ°πÁõÆÔºåÁî®‰∫éÊâßË°åÂçïÂÖÉÊµãËØï„ÄÇ</p>
<p>Êï¥‰∏™È°πÁõÆÁöÑÁªìÊûÑÂ¶Ç‰∏ãÂõæÔºö</p>
<p><img src="/p/jenkins-combines-docker-to-implement-low-level-ci/1569319357702.png"
	width="652"
	height="582"
	srcset="/p/jenkins-combines-docker-to-implement-low-level-ci/1569319357702_hub5fbb990ae23cdbfcec8ec51f9c825e9_27201_480x0_resize_box_3.png 480w, /p/jenkins-combines-docker-to-implement-low-level-ci/1569319357702_hub5fbb990ae23cdbfcec8ec51f9c825e9_27201_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="1569319357702"
	
	
		class="gallery-image" 
		data-flex-grow="112"
		data-flex-basis="268px"
	
></p>
<p>Êàë‰ª¨ÈúÄË¶ÅÁºñÂÜô‰∏Ä‰∏™ <code>UnitTest.Dockerfile</code> ÈïúÂÉèÔºåÁî®‰∫éÊâßË°å xUnit ÂçïÂÖÉÊµãËØï„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="k">FROM</span><span class="s"> mcr.microsoft.com/dotnet/core/sdk:2.2</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># ËøòÂéü NuGet ÂåÖ„ÄÇ</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">WORKDIR</span><span class="s"> /home/app</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> ./ ./<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> dotnet restore<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENTRYPOINT</span> <span class="p">[</span><span class="s2">&#34;dotnet&#34;</span><span class="p">,</span> <span class="s2">&#34;test&#34;</span> <span class="p">,</span> <span class="s2">&#34;--verbosity=normal&#34;</span><span class="p">]</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>‰πãÂêé‰∏∫ÈÉ®ÁΩ≤Êìç‰ΩúÁºñÂÜô‰∏Ä‰∏™ <code>Deploy.Dockerfile</code> ÔºåËøô‰∏™ Dockerfile È¶ñÂÖàËøòÂéü‰∫Ü NuGet ÂåÖÔºåÁÑ∂ÂêéÈÄöËøá <code>dotnet publish</code> ÂëΩ‰ª§ÂèëÂ∏É‰∫ÜÊàë‰ª¨ÁöÑÁΩëÁ´ô„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="k">FROM</span><span class="s"> mcr.microsoft.com/dotnet/core/sdk:2.2 as build-image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># ËøòÂéü NuGet ÂåÖ„ÄÇ</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">WORKDIR</span><span class="s"> /home/app</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> ./ ./<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> dotnet restore<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># ÂèëÂ∏ÉÈïúÂÉè„ÄÇ</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> ./ ./<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> dotnet publish ./TestProject.WebApi/TestProject.WebApi.csproj -o /publish/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> mcr.microsoft.com/dotnet/core/aspnet:2.2</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">WORKDIR</span><span class="s"> /publish</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> --from<span class="o">=</span>build-image /publish .<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENTRYPOINT</span> <span class="p">[</span><span class="s2">&#34;dotnet&#34;</span><span class="p">,</span> <span class="s2">&#34;TestProject.WebApi.dll&#34;</span><span class="p">]</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>‰∏§‰∏™ Dockerfile ÁºñÂÜôÂÆåÊàê‰πãÂêéÔºåÂ∞ÜÂÖ∂Â≠òÊîæÂú®È°πÁõÆÁöÑÊ†πÁõÆÂΩïÔºå‰ª•‰æø Slave ËøõË°åÊûÑÂª∫„ÄÇ</p>
<p>Dockerfile ÁºñÂÜôÂ•Ω‰∫ÜÔºåÈÇ£‰πàÊàë‰ª¨ËøòË¶ÅÂàÜÂà´‰∏∫‰∏§‰∏™ÈïúÂÉèÁºñÂÜô Docker Compose Êñá‰ª∂ÔºåÁî®‰∫éÊâßË°åÂçïÂÖÉÊµãËØïÂíåÈÉ®ÁΩ≤Ë°å‰∏∫ÔºåÁî®‰∫éÈÉ®ÁΩ≤ÁöÑÊñá‰ª∂ÂêçÁß∞Âè´ÂÅö <code>docker-compose.Deploy.yaml</code>ÔºåÂÜÖÂÆπÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;3.1&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">backend</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">dev-test-backend</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">dev-test:B${BUILD_NUMBER}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s1">&#39;5000:5000&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l">always</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ÁÑ∂ÂêéÊàë‰ª¨ÈúÄË¶ÅÁºñÂÜôËøêË°åÂçïÂÖÉÊµãËØïÁöÑ Docker Compose Êñá‰ª∂ÔºåÂêçÂ≠óÂè´ÂÅö <code>docker-compose.UnitTest.yaml</code>ÔºåÂÜÖÂÆπÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;3.1&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">backend</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">dev-test-unit-test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">dev-test:TEST${BUILD_NUMBER}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="‰∫îÁºñÂÜô-jenkinsfile">‰∫î„ÄÅÁºñÂÜô Jenkinsfile</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">node(&#39;docker&#39;) {
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    stage &#39;Á≠æÂá∫‰ª£Á†Å&#39;
</span></span><span class="line"><span class="cl">        checkout scm
</span></span><span class="line"><span class="cl">    stage &#39;ÂçïÂÖÉÊµãËØï&#39;
</span></span><span class="line"><span class="cl">        sh &#34;docker build -t dev-test:TEST${BUILD_NUMBER} -f UnitTest.Dockerfile .&#34;
</span></span><span class="line"><span class="cl">        sh &#34;docker-compose -f docker-compose.UnitTest.yaml up --force-recreate --abort-on-container-exit&#34;
</span></span><span class="line"><span class="cl">        sh &#34;docker-compose -f docker-compose.UnitTest.yaml down -v&#34;
</span></span><span class="line"><span class="cl">    stage &#39;ÈÉ®ÁΩ≤È°πÁõÆ&#39;
</span></span><span class="line"><span class="cl">        sh &#34;docker build -t dev-test:B${BUILD_NUMBER} -f Deploy.Dockerfile .&#34;
</span></span><span class="line"><span class="cl">        sh &#39;docker-compose -f docker-compose.Deploy.yaml up -d&#39;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ÂÖ≠ÊúÄÂêéÁöÑÊïàÊûú">ÂÖ≠„ÄÅÊúÄÂêéÁöÑÊïàÊûú</h2>
<p>‰∏äËø∞Êìç‰ΩúÂÆåÊàê‰πãÂêéÔºåÂ∞ÜËøô‰∫õÊñá‰ª∂ÊîæÂú®È°πÁõÆÊ†πÁõÆÂΩï„ÄÇ</p>
<p><img src="/p/jenkins-combines-docker-to-implement-low-level-ci/1569342792065.png"
	width="1982"
	height="737"
	srcset="/p/jenkins-combines-docker-to-implement-low-level-ci/1569342792065_hu358f8da16c3be33ab3fab64c57a6129c_169831_480x0_resize_box_3.png 480w, /p/jenkins-combines-docker-to-implement-low-level-ci/1569342792065_hu358f8da16c3be33ab3fab64c57a6129c_169831_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="1569342792065"
	
	
		class="gallery-image" 
		data-flex-grow="268"
		data-flex-basis="645px"
	
></p>
<p>ÂõûÂà∞ JenkinsÔºå‰Ω†ÂèØ‰ª•ÊâãÂä®ÊâßË°å‰∏Ä‰∏ã‰ªªÂä°ÔºåÁÑ∂ÂêéÈ°πÁõÆÂ∞±Ë¢´ÊàêÂäüÊâßË°å‰∫Ü„ÄÇ</p>
<p><img src="/p/jenkins-combines-docker-to-implement-low-level-ci/1569342849864.png"
	width="3831"
	height="1362"
	srcset="/p/jenkins-combines-docker-to-implement-low-level-ci/1569342849864_hu96e02516599d5f0fe503257b4b97e1e7_320697_480x0_resize_box_3.png 480w, /p/jenkins-combines-docker-to-implement-low-level-ci/1569342849864_hu96e02516599d5f0fe503257b4b97e1e7_320697_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="1569342849864"
	
	
		class="gallery-image" 
		data-flex-grow="281"
		data-flex-basis="675px"
	
></p>
<p><img src="/p/jenkins-combines-docker-to-implement-low-level-ci/1569342887871.png"
	width="3740"
	height="1808"
	srcset="/p/jenkins-combines-docker-to-implement-low-level-ci/1569342887871_hu99442620474d692a7b59fa8df01e7b4c_435041_480x0_resize_box_3.png 480w, /p/jenkins-combines-docker-to-implement-low-level-ci/1569342887871_hu99442620474d692a7b59fa8df01e7b4c_435041_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="1569342887871"
	
	
		class="gallery-image" 
		data-flex-grow="206"
		data-flex-basis="496px"
	
></p>
<p><img src="/p/jenkins-combines-docker-to-implement-low-level-ci/1569342899658.png"
	width="3775"
	height="868"
	srcset="/p/jenkins-combines-docker-to-implement-low-level-ci/1569342899658_hub2aef015a7251f2972a330850af6a8ad_106869_480x0_resize_box_3.png 480w, /p/jenkins-combines-docker-to-implement-low-level-ci/1569342899658_hub2aef015a7251f2972a330850af6a8ad_106869_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="1569342899658"
	
	
		class="gallery-image" 
		data-flex-grow="434"
		data-flex-basis="1043px"
	
></p>
<p>Ëá≥Ê≠§ÔºåÊàë‰ª¨ÁöÑ ‚Äú‰ΩéÈÖçÁâà‚Äù CI„ÄÅCD ÁéØÂ¢ÉÂ∞±Êê≠Âª∫ÊàêÂäü‰∫Ü„ÄÇ</p>
</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/jenkins/">Jenkins</a>
        
            <a href="/tags/docker/">Docker</a>
        
            <a href="/tags/ci/cd/">CI/CD</a>
        
            <a href="/tags/docker-compose/">Docker Compose</a>
        
            <a href="/tags/devops/">DevOps</a>
        
            <a href="/tags/linux/">Linux</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Áõ∏ÂÖ≥ÊñáÁ´†</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/p/continuous-integrationdeployment-for-net-core-with-jenkins/">
        
        

        <div class="article-details">
            <h2 class="article-title">‰ΩøÁî® Jenkins ‰∏∫ .Net Core ÂÆûÁé∞ÊåÅÁª≠ÈõÜÊàê/ÈÉ®ÁΩ≤</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/install-docker-compose-on-centos-7x/">
        
        

        <div class="article-details">
            <h2 class="article-title">CentOS 7.x ÂÆâË£Ö Docker-Compose</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/harbor-212-installation-and-deployment/">
        
        

        <div class="article-details">
            <h2 class="article-title">Harbor 2.1.2 ÂÆâË£ÖÈÉ®ÁΩ≤</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/docker-container-directory-garbled-problem-with-dotnet-core/">
        
        

        <div class="article-details">
            <h2 class="article-title">dotNET Core ÁöÑ Docker ÂÆπÂô®ÁõÆÂΩï‰π±Á†ÅÈóÆÈ¢ò</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/docker-install-elk/">
        
        

        <div class="article-details">
            <h2 class="article-title">Docker ÂÆâË£Ö ELK</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script
    src="https://giscus.app/client.js"
    data-repo="real-zony/real-zony.github.io"
    data-repo-id="R_kgDOIC_OeA"
    data-category="General"
    data-category-id="DIC_kwDOIC_OeM4CRp3M"
    data-mapping="pathname"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="top"
    data-theme="preferred_color_scheme"
    data-lang="en"
    crossorigin="anonymous"
    async
></script>
<script>
    function setGiscusTheme(theme) {
        let giscus = document.querySelector("iframe.giscus-frame");
        if (giscus) {
            giscus.contentWindow.postMessage(
                {
                    giscus: {
                        setConfig: {
                            theme: theme,
                        },
                    },
                },
                "https://giscus.app"
            );
        }
    }

    (function () {
        addEventListener("message", (e) => {
            if (event.origin !== "https://giscus.app") return;
            handler();
        });
        window.addEventListener("onColorSchemeChange", handler);

        function handler() {
            if (document.documentElement.dataset.scheme === "light") {
                setGiscusTheme('preferred_color_scheme');
            } else {
                setGiscusTheme('preferred_color_scheme');
            }
        }
    })();
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2024 Zony ÁöÑÂçöÂÆ¢
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        ‰∏ªÈ¢ò <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.13.0">Stack</a></b> Áî± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> ËÆæËÆ°
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ÁõÆÂΩï</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#‰∏Äjenkins-ÁöÑÈÉ®ÁΩ≤">‰∏Ä„ÄÅJenkins ÁöÑÈÉ®ÁΩ≤</a>
      <ol>
        <li><a href="#11-ÊûÑÂª∫-master-ÈïúÂÉè">1.1 ÊûÑÂª∫ Master ÈïúÂÉè</a></li>
        <li><a href="#12-ÊûÑÂª∫-slave-ÈïúÂÉè">1.2 ÊûÑÂª∫ Slave ÈïúÂÉè</a></li>
        <li><a href="#13-ÁºñÂÜô-docker-compose-Êñá‰ª∂">1.3 ÁºñÂÜô Docker Compose Êñá‰ª∂</a></li>
      </ol>
    </li>
    <li><a href="#‰∫ågogs-ÁöÑÈÉ®ÁΩ≤">‰∫å„ÄÅGogs ÁöÑÈÉ®ÁΩ≤</a></li>
    <li><a href="#‰∏âgogs-‰∏é-jenkins-ÁöÑÈõÜÊàê">‰∏â„ÄÅGogs ‰∏é Jenkins ÁöÑÈõÜÊàê</a>
      <ol>
        <li><a href="#31-ÂàõÂª∫ÊµÅÊ∞¥Á∫øÈ°πÁõÆ">3.1 ÂàõÂª∫ÊµÅÊ∞¥Á∫øÈ°πÁõÆ</a></li>
        <li><a href="#32-jenkins-ÁöÑ-webhook-ÈÖçÁΩÆ">3.2 Jenkins ÁöÑ Webhook ÈÖçÁΩÆ</a></li>
        <li><a href="#33-gogs-ÁöÑ-webhook-ÈÖçÁΩÆ">3.3 Gogs ÁöÑ Webhook ÈÖçÁΩÆ</a></li>
        <li><a href="#34-ÈôêÂÆö‰ªªÂä°Ëß¶ÂèëÊù°‰ª∂">3.4 ÈôêÂÆö‰ªªÂä°Ëß¶ÂèëÊù°‰ª∂</a></li>
      </ol>
    </li>
    <li><a href="#ÂõõÂÆåÊï¥ÁöÑÈ°πÁõÆÁ§∫‰æã">Âõõ„ÄÅÂÆåÊï¥ÁöÑÈ°πÁõÆÁ§∫‰æã</a></li>
    <li><a href="#‰∫îÁºñÂÜô-jenkinsfile">‰∫î„ÄÅÁºñÂÜô Jenkinsfile</a></li>
    <li><a href="#ÂÖ≠ÊúÄÂêéÁöÑÊïàÊûú">ÂÖ≠„ÄÅÊúÄÂêéÁöÑÊïàÊûú</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
